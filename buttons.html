<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Button Stuff</title>
    <script src="https://pixijs.download/release/pixi.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chroma-js/2.4.2/chroma.min.js
"></script>
  </head>

  <body>
    <script>
      const app = new PIXI.Application({
        width: 640,
        height: 480,
        backgroundColor: 0x000000,
      });

      document.body.appendChild(app.view);

      // Our Button
      class Button extends PIXI.Container {
        constructor(label = "Button", w = 200, h = 50) {
          super();
          this.label = label;
          this.h = h;
          this.w = w;

          // Make container interactive
          this.interactive = true;

          //Button Body
          const buttonBody = new PIXI.Graphics();
          buttonBody.beginFill(0xcccccc);
          buttonBody.drawRect(0, 0, this.w, this.h);
          buttonBody.endFill();
          this.addChild(buttonBody);
          this.buttonBody = buttonBody;

          //Button Label
          const buttonLabel = new PIXI.Text(this.label);
          buttonLabel.anchor.set(0.5);
          buttonLabel.x += buttonBody.width / 2;
          buttonLabel.y += buttonBody.height / 2;
          this.addChild(buttonLabel);
          this.buttonLabel = buttonLabel;

          // Event listeners
          this.on("pointertap", (e) => {
            console.log(e);
            const color = Math.random() * 0xffffff;
            buttonBody.tint = color;
          });

          this.on("pointerover", (e) => {
            buttonBody.alpha = 0.7;
          });

          this.on("pointerout", (e) => {
            buttonBody.alpha = 1;
          });

          // Draggable event listeners
          this.draggable = false; //whether it can drag
          this.dragging = false; //whether this is currently being dragged

          // Offsets prevent button from snapping onto cursor upon dragging
          this.offsetX;
          this.offsteY;

          this.on("pointerdown", (e) => {
            if (!this.draggable) return;
            this.dragging = true;
            this.offsetX = this.x - e.global.x;
            this.offsetY = this.y - e.global.y;
          });

          this.on("pointermove", (e) => {
            if (!this.draggable) return;
            // console.log(e.global.x, e.global.y);
            if (this.dragging) {
              this.x = e.global.x + this.offsetX;
              this.y = e.global.y + this.offsetY;
            }
          });
          this.on("pointerup", (e) => {
            if (!this.draggable) return;
            this.dragging = false;
          });

          // Failsafe. Just in case pointer ends up outside of button somehow
          this.on("pointerupoutside", (e) => {
            if (!this.draggable) return;
            this.dragging = false;
          });
        }
      }

      class Toggle extends Button {
        constructor(label, w, h) {
          super(label, w, h);
          // Extra variables
          this.value = false;
          // Event listeners
          this.on("pointertap", (e) => {
            this.value = !this.value;
            console.log(this.value);

            if (this.value == true) {
              this.buttonBody.tint = 0x00cc00;
            } else {
              this.buttonBody.tint = 0xcccc00;
            }
          });
        }
      }

      class Slider extends PIXI.Container {
        constructor() {
          super();
          this.interactive = true;
          // Extra Variables
          this.dragging = false;
          this.value = 0;

          //The Track

          const track = new PIXI.Graphics();
          track.beginFill(0xeeeeee);
          track.drawRect(0, -10, 300, 20);
          track.endFill();

          this.addChild(track);

          //The Slide;
          const slide = new PIXI.Graphics();
          slide.beginFill(0xcccccc);
          slide.drawRect(-25, -25, 50, 50);
          slide.endFill();


          this.addChild(slide);

          //Events
          this.on("pointerdown", (e) => {
            this.dragging = true;
            console.log(e);
          });

          this.on("pointermove", (e) => {
            if (this.dragging) {
              // Move the slider
              slide.x = e.global.x - this.getGlobalPosition().x;
              // Check constraints
              if (slide.x > track.width) slide.x = track.width;
              if (slide.x < 0) slide.x = 0;
              // Check value
              this.value = slide.x / track.width;
            }
          });

          this.on("pointerup", (e) => {
            this.dragging = false;
          });

          this.on("pointerupoutside", (e) => {
            this.dragging = false;
          });
        }
      }

      // Make Button
      const myButton = new Button("Hello!", 200, 200);
      myButton.draggable = true;

      // Make Toggle
      const myToggle = new Toggle("Toggle", 100, 100);
      myToggle.x = 300;

      //Make Slider
      const mySlider = new Slider();
      mySlider.x = 50;
      mySlider.y = 400;

      app.stage.addChild(myButton);
      app.stage.addChild(myToggle);
      app.stage.addChild(mySlider);
    </script>
  </body>

</html>